<html>
<head>
  <style>
    .vip-content {
      display: none;
    }

    .vip-content.show {
      display: block;
    }

    #emoji-list {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      grid-gap: 10px;;
      max-width: 400px;
    }

    .emoji-item {
      position: relative;
      cursor: default;
      height: 70px;
    }

    .emoji-image {
      display: inline-block;
      transition: all .06s ease-in-out;
    }

    .emoji-image.enlarge {
      font-size: 40px;
    }

    .emoji-desc {
      display: none;
      background-color: #000;
      color: #fff;
      padding: 5px;
      border-radius: 6px;
      position: absolute;
      top: 46px;
      left: 0;
      z-index: 1;
      font-size: 14px;
      pointer-events: none;
    }

    .emoji-item:hover .emoji-desc {
      display: block;
    }

    #get-user:disabled {
      background-image: url(https://samherbert.net/svg-loaders/svg-loaders/three-dots.svg);
      background-repeat: no-repeat;
      background-color: black;
      background-size: 40px;
      background-position: center;
      color: transparent;
    }

    footer {
      position: absolute;
      background: #000;
      color: #fff;
      width: 100%;
      height: 60px;
      left: 0;
      bottom: 0;
    }
  </style>
</head>
<body>
  <script src="./analytics.js" defer></script>
  <script src="./emojis.js"></script>


  <video id="hero-vid" src="https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4" loop muted playsinline preload="auto" type="video/mp4" disableremoteplayback></video>





  <h1>Emoji Shop</h1>
  <h2 id="emoji"></h2>

  <nav>
    <a class="nav-item home" href="#">Home</a>
    <a class="nav-item products" href="#">Products</a>
    <a class="nav-item login" href="#">Login</a>
  </nav>

  <form class="emoji-filters">
    <button class="emoji-filter" data-sort="a-z">Sort A-Z</button>
    <button class="emoji-filter" data-sort="z-a">Sort Z-A</button>
  </form>
  <div id="emoji-list"></div>
  <form>
    <button id="load-more-emojis">Load More Emojis</button>
  </form>



  <button id="get-vip-level-btn">Get VIP Level</button>



  <div class="vip-content pearl">
    <h3>VIP LEVEL: Pearl</h3>
    <p>You're a pearl person</p>
  </div>

  <div class="vip-content platinum">
    <h3>VIP LEVEL: Platinum</h3>
    <p>You're a platinum person</p>
  </div>

  <div class="vip-content emerald">
    <h3>VIP LEVEL: Emerald</h3>
    <p>You're a emerald person</p>
  </div>

  <div class="vip-content gold">
    <h3>VIP LEVEL: Gold</h3>
    <p>You're a gold person</p>
  </div>

  <br>
  <br>
  <button id="get-user">Get user</button>
  <div id="user-block"></div>


  
  <button id="get-script">Add Back to Top</button>
  <div id="mock-content"></div>

  <footer>JS Bits</footer>
  <script>
    initListenerBug();

    function initListenerBug() {
      setFooterBottom();
      initFooterListener();

      const postArr = [];
      const mockContentEl = document.querySelector('#mock-content');

      fetch('https://jsonplaceholder.typicode.com/posts')
        .then(response => response.json())
        .then(posts => {
          for (let i = 0; i < 25; i++) {
            postArr.push(posts[i].body);
          }

          const mockContentHTML = postArr.map(post => `<div>${post}</div>`);
          mockContentEl.insertAdjacentHTML('afterbegin', mockContentHTML);
        });
    }

    function initFooterListener() {
      window.onscroll = setFooterBottom;
    }

    function setFooterBottom() {
      const footer = document.querySelector('footer');
      footer.style.bottom = `-${window.scrollY}px`;
    }

    document.querySelector('#get-script').addEventListener('click', () => {
      const backToTopScript = document.createElement('script');
      backToTopScript.src = '/bug-finder/back-to-top.js';
      document.head.insertAdjacentElement('beforeend', backToTopScript);
    });




    document.addEventListener('DOMContentLoaded', () => {
      const timeout = 0;

      setTimeout(setEmojiStatus, timeout);
      const emojiStatus = getEmojiStatus();
      if (emojiStatus) showWarning();
    });

    function setEmojiStatus() {
      window.emoji = true;
    }

    function showWarning() {
      document.body.insertAdjacentHTML('afterbegin', '<div>[DO NOT SHOW]</div>');
    }

    function getEmojiStatus() {
      return Boolean(emoji);
    }

    document.querySelector('#get-user').addEventListener('click', getuser);

    function getuser(e) {
      e.target.disabled = true;

      const indices = [];
      for (var i = 5; i < 10; i++) {

        // Delay to show animation
        setTimeout(() => {
          indices.push(i);
        }, 500);
      }

      setTimeout(() => {
        const randomIndex = getRandomIndex(indices);
        console.log(randomIndex);

        fetch(`https://jsonplaceholder.typicode.com/users/${randomIndex}`)
          .then(response => response.json())
          .then(handleRes.bind(null, e));
      }, 1000);
    }


    function handleRes(e, user) {
      const userBlock = document.querySelector('#user-block');

      if (user) {
        console.log('user!', user);
        userBlock.innerHTML = ` ${user.name} | ${user.email}`;
      }

      e.target.disabled = false;
    }



    function getRandomIndex(arr) {
      const random = Math.random();
      const arrLength = arr.length;

      return arr[Math.floor(random * arrLength)];
    }

    renderEmojiList();
    bindEnlargeListener();

    function renderEmojiList() {
      const emojiListEl = document.querySelector('#emoji-list');
      const emojiListHTML = window.emojis.map(emojiObj => {
        return `<div class="emoji-item">
          <div class="emoji-image">${emojiObj.emoji}</div>
          <div class="emoji-name">${emojiObj.name}</div>
          <div class="emoji-desc">${emojiObj.desc}</div>
        </div>`;
      }).join('');
      emojiListEl.innerHTML = emojiListHTML;
    }

    function bindEnlargeListener() {
      const emojiImages = document.querySelectorAll('.emoji-image');
      emojiImages.forEach(emojiImage => {
        emojiImage.addEventListener('click', () => {
          emojiImage.classList.toggle('enlarge');
        });
      });
    }

    document.querySelectorAll('.emoji-filter').forEach(btn => {
      btn.addEventListener('click', () => {
        const direction = (btn.dataset.sort === 'a-z') ? -1 : 1;

        window.emojis.sort((a, b) => {
          if (a.name < b.name) return direction;
          else if (a.name > b.name) return -1 * direction;
          else return 0;
        });

        renderEmojiList();
      });
    });


    const VIPLevels = {
      pearl: 'pearl',
      platinum: 'platinum',
      emerald: 'emerald',
      gold: 'gold',
      default: function() { return this.pearl }
    };

    // Set VIP cookie to platinum on load
    setCookie('vipCustomerLevel', VIPLevels.platinum);

    // Init main script
    document.addEventListener('DOMContentLoaded', init);

  
    function init() {
      const btn = document.querySelector('#get-vip-level-btn');
      btn.addEventListener('click', showVIPLevel);
    }
  
    function showVIPLevel() {
      const VIPLevel = getVIPCookieVal() || VIPLevels.default();
      const blockToShow = document.querySelector(`.${VIPLevel}`);
      blockToShow.classList.add('show');
    }

    function getVIPCookieVal() {
      return getCookie('vipCustomerLevel');
    }

    function getCookie(name) {
      const nameEQ = `${name}=`;
      const ca = document.cookie.split(';');

      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];

        while (c.charAt(0) === ' ') {
          c = c.substring(1, c.length);
        }

        if (c.indexOf(nameEQ) === 0) {
          return c.substring(nameEQ.length, c.length);
        }
      }

      return null;
    }


    function setCookie(name, value, minutes) {
      let expirationFragment = '';

      if (minutes) {
        const date = new Date();
        const ms = minutes * 60 * 1000;
        const expiration = date.getTime() + ms;

        date.setTime(expiration);
        expirationFragment = `; expires=${date.toGMTString()}`;
      }

      document.cookie = `${name}=${value}${expirationFragment}; path=/`;
    }
  </script>
</body>
</html>
